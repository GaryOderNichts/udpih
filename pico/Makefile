CMAKE_SOURCE_DIR := .
CMAKE_BUILD_RP2040_DIR := build_rp2040
CMAKE_BUILD_RP2350_DIR := build_rp2350

.PHONY: all clean $(CMAKE_BUILD_RP2040_DIR)/Makefile $(CMAKE_BUILD_RP2040_DIR)/udpih.uf2 $(CMAKE_BUILD_RP2350_DIR)/Makefile $(CMAKE_BUILD_RP2350_DIR)/udpih.uf2

all: $(CMAKE_BUILD_RP2040_DIR)/udpih.uf2 $(CMAKE_BUILD_RP2350_DIR)/udpih.uf2

$(CMAKE_BUILD_RP2040_DIR)/Makefile: $(CMAKE_SOURCE_DIR)/CMakeLists.txt
	cmake -S $(<D) -B $(@D) -DPICO_BOARD=pico

$(CMAKE_BUILD_RP2040_DIR)/udpih.uf2: $(CMAKE_BUILD_RP2040_DIR)/Makefile
	$(MAKE) -C $(@D)

$(CMAKE_BUILD_RP2350_DIR)/Makefile: $(CMAKE_SOURCE_DIR)/CMakeLists.txt
	cmake -S $(<D) -B $(@D) -DPICO_BOARD=pico2

$(CMAKE_BUILD_RP2350_DIR)/udpih.uf2: $(CMAKE_BUILD_RP2350_DIR)/Makefile
	$(MAKE) -C $(@D)

clean:
	rm -rf $(CMAKE_BUILD_RP2040_DIR) $(CMAKE_BUILD_RP2350_DIR)
